<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MonKutir - Cloud Shopping</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: #f4f7f6; }

        header {
            background: #2c3e50; padding: 10px 5%;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .logo-area { display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .shop-logo { width: 40px; height: 40px; object-fit: contain; background: #fff; border-radius: 5px; }
        .logo-text { font-size: 22px; font-weight: bold; color: #3498db; }
        .logo-text span { color: #fff; }

        .auth-display { color: white; display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .signout-btn { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .login-nav-btn { background: #3498db; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }

        .top-sec { background: #34495e; padding: 20px; text-align: center; }
        .search-box { width: 90%; max-width: 500px; padding: 12px 20px; border-radius: 25px; border: none; outline: none; margin-bottom: 15px; }
        
        .categories { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .cat-btn { padding: 8px 18px; background: rgba(255,255,255,0.1); color: white; border-radius: 20px; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); }
        .cat-btn.active { background: #3498db; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 10px; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }

        .product-card { background: white; border-radius: 12px; padding: 12px; text-align: center; border: 1px solid #eee; display: flex; flex-direction: column; }
        .img-container { width: 100%; height: 160px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
        .product-card img { max-width: 100%; max-height: 100%; object-fit: contain; }

        .price-tag { font-size: 18px; color: #e74c3c; font-weight: bold; margin-bottom: 10px; }
        .product-name { font-size: 15px; font-weight: 600; margin-bottom: 8px; height: 40px; overflow: hidden; }
        .buy-btn { background: #27ae60; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; }

        @media (max-width: 600px) { .product-grid { grid-template-columns: repeat(2, 1fr); } }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: white; padding: 25px; border-radius: 10px; width: 90%; max-width: 350px; text-align: center; }
        .modal input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; }
        .toggle-auth { font-size: 12px; color: #3498db; cursor: pointer; text-decoration: underline; margin-top: 10px; display: block; }
    </style>
</head>
<body>

<header>
    <div class="logo-area" onclick="location.reload()">
        <img src="https://i.postimg.cc/6pwZL7XT/fsdtgyy.png" alt="Logo" class="shop-logo">
        <div class="logo-text">MonKutir<span></span></div>
    </div>
    <div id="authBox">
        <button class="login-nav-btn" onclick="openM('authModal')">Login / Sign Up</button>
    </div>
</header>

<div class="top-sec">
    <input type="text" class="search-box" id="srch" onkeyup="search()" placeholder="‡¶™‡¶£‡ßç‡¶Ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
    <div class="categories">
        <button class="cat-btn active" onclick="filter('all', this)">All</button>
        <button class="cat-btn" onclick="filter('Electronics', this)">Electronics</button>
        <button class="cat-btn" onclick="filter('Fashion', this)">Fashion</button>
    </div>
</div>

<div class="container">
    <div class="product-grid" id="display">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
</div>

<div class="modal" id="authModal">
    <div class="modal-content">
        <h2 id="authTitle">Login</h2>
        <div id="signupFields" style="display: none;">
            <input type="text" id="uName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        </div>
        <input type="email" id="uEmail" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
        <input type="password" id="uPass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°">
        <button class="buy-btn" id="authSubmit" onclick="handleAuth()">Login</button>
        <span class="toggle-auth" id="toggleText" onclick="toggleAuthMode()">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶® (Sign Up)</span>
        <p onclick="closeM('authModal')" style="cursor:pointer; margin-top:10px; color:gray;">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</p>
    </div>
</div>

<div class="modal" id="shipModal">
    <div class="modal-content">
        <h2 id="pSel" style="color:#27ae60">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞</h2>
        <input type="text" id="sName" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="text" id="sPhone" placeholder="‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        <input type="text" id="sAddr" placeholder="‡¶™‡ßÅ‡¶∞‡ßã ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">
        <button class="buy-btn" onclick="submitOrder()">Confirm Order</button>
        <p onclick="closeM('shipModal')" style="cursor:pointer; margin-top:10px; color:gray;">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</p>
    </div>
</div>

<script>
    // --- Firebase Configuration ---
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        databaseURL: "https://barrahms-app-default-rtdb.firebaseio.com",
        projectId: "barrahms-app",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allP = [];
    let isLoginMode = true;
    let selectedItemName = ""; // ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶∞‡¶æ‡¶ñ‡¶æ‡¶∞ ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
    let currentUser = JSON.parse(localStorage.getItem('shopUser')) || null;

    function load() {
        if(currentUser) updateHeader();
        db.ref('products').on('value', (snap) => {
            const data = snap.val();
            const displayDiv = document.getElementById('display');
            if(!data) { displayDiv.innerHTML = "‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á!"; return; }
            allP = Object.keys(data).map(key => ({...data[key], id: key}));
            render(allP);
        });
    }

    function render(items) {
        document.getElementById('display').innerHTML = items.map(p => `
            <div class="product-card">
                <div class="img-container"><img src="${p.image}"></div>
                <div class="product-name">${p.name}</div>
                <div class="price-tag">‡ß≥${p.offer || p.price}</div>
                <button class="buy-btn" onclick="buy('${p.name}')">Buy Now</button>
            </div>`).join('');
    }

    // --- Authentication Logic ---
    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('authTitle').innerText = isLoginMode ? "Login" : "Sign Up";
        document.getElementById('signupFields').style.display = isLoginMode ? "none" : "block";
        document.getElementById('authSubmit').innerText = isLoginMode ? "Login" : "Sign Up";
        document.getElementById('toggleText').innerText = isLoginMode ? "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶® (Sign Up)" : "‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá? (Login)";
    }

    function handleAuth() {
        const email = document.getElementById('uEmail').value.trim();
        const pass = document.getElementById('uPass').value.trim();
        const name = document.getElementById('uName').value.trim();

        if(!email || !pass) return alert("‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®!");

        const userId = email.replace(/[.$#[\]]/g, "_");

        if(!isLoginMode) {
            if(!name) return alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®!");
            db.ref('users/' + userId).set({ name, email, pass }, (err) => {
                if(!err) {
                    alert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                    toggleAuthMode();
                }
            });
        } else {
            db.ref('users/' + userId).once('value', (snap) => {
                const userData = snap.val();
                if(userData && userData.pass === pass) {
                    currentUser = userData;
                    localStorage.setItem('shopUser', JSON.stringify(userData));
                    alert("‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!");
                    location.reload();
                } else {
                    alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°!");
                }
            });
        }
    }

    function updateHeader() {
        document.getElementById('authBox').innerHTML = `
            <div class="auth-display">
                <span>üë§ ${currentUser.name}</span>
                <button class="signout-btn" onclick="signOut()">Sign Out</button>
            </div>`;
    }

    function signOut() {
        localStorage.removeItem('shopUser');
        alert("‡¶∏‡¶æ‡¶á‡¶®-‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
        location.reload();
    }

    // --- Order Logic ---
    function buy(name) {
        if(!currentUser) return openM('authModal');
        selectedItemName = name; // ‡¶™‡¶£‡ßç‡¶Ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
        document.getElementById('pSel').innerText = name;
        openM('shipModal');
    }

    function submitOrder() {
        const name = document.getElementById('sName').value.trim();
        const phone = document.getElementById('sPhone').value.trim();
        const addr = document.getElementById('sAddr').value.trim();

        if(!name || !phone || !addr) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");

        const orderData = {
            customerName: name,
            customerPhone: phone,
            address: addr,
            product: selectedItemName,
            userEmail: currentUser.email,
            orderDate: new Date().toLocaleString()
        };

        db.ref('orders').push(orderData)
            .then(() => {
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
                closeM('shipModal');
                // ‡¶´‡¶ø‡¶≤‡ßç‡¶°‡¶ó‡ßÅ‡¶≤‡ßã ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
                document.getElementById('sName').value = "";
                document.getElementById('sPhone').value = "";
                document.getElementById('sAddr').value = "";
            })
            .catch((err) => {
                alert("‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                console.error(err);
            });
    }

    // --- Utility Functions ---
    function search() {
        let v = document.getElementById('srch').value.toLowerCase();
        render(allP.filter(p => p.name.toLowerCase().includes(v)));
    }

    function filter(category, btn) {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render(category === 'all' ? allP : allP.filter(p => p.category === category));
    }

    function openM(id) { document.getElementById(id).style.display = 'flex'; }
    function closeM(id) { document.getElementById(id).style.display = 'none'; }

    window.onload = load;
</script>
</body>
</html>
